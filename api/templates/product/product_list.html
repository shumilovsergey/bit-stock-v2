{% extends 'base.html' %}
{% block title %}
bit-stock
{% endblock %}
{% block content %}
{% load static %}


<div class="">
    <table class="">
        <thead class="">
            <tr class="">
                <th class="rounded-tl-2xl bg-amber-100 border-b border-r border-stone-700 text-left px-8 py-4 font-normal">категория</th>
                <th class="bg-amber-100 border-b border-r border-stone-700 text-left px-8 py-4 font-normal">бренд</th>
                <th class="bg-amber-100 border-b border-r border-stone-700 text-left px-8 py-4 font-normal">товар</th>
                <th class="rounded-tr-2xl bg-amber-100 border-b border-stone-700 text-left px-8 py-4 font-normal">количество</th>
            </tr>
        </thead>

        <tbody id="tableBody" class="">
            <form action="{% url 'api:product_list' %}" method="post">
                {% csrf_token %}
                <tr>
                    <td class="bg-amber-50 min-w-64 border-b border-r border-stone-700 text-left px-2 py-4">
                        <div class="flex justify-between">
                            <div class="h-10 pt-1 px-4 border rounded-xl border-stone-700  hover:border-2 hover:border-b-4 shadow-md" onclick="clearInput('categoryInput')">x</div>
                            <input name="category" class="w-48 h-10 shadow-md border-b-2 border-stone-700 rounded-xl focus:ring-stone-700 focus:border-b-4 focus:border-stone-700" type="text" id="categoryInput" onkeyup="filterTable()" required>
                        </div>
                    </td>
                    <td class="bg-amber-50 min-w-64 border-b border-r border-stone-700 text-left px-2 py-4">
                        <div class="flex justify-between">
                            <div class="h-10 pt-1 px-4 border rounded-xl border-stone-700  hover:border-2 hover:border-b-4 shadow-md" onclick="clearInput('brandInput')">x</div>
                            <input name="brand" class="w-48 h-10 shadow-md border-b-2 border-stone-700 rounded-xl focus:ring-stone-700 focus:border-b-4 focus:border-stone-700" type="text" id="brandInput" onkeyup="filterTable()" required>
                        </div>    
                    </td>
                    <td class="bg-amber-50 min-w-64 border-b border-r border-stone-700 text-left px-2 py-4">
                        <div class="flex justify-between">
                            <div class="h-10 pt-1 px-4 border rounded-xl border-stone-700  hover:border-2 hover:border-b-4 shadow-md" onclick="clearInput('productInput')">x</div>
                            <input name="product" class="w-48 h-10 shadow-md border-b-2 border-stone-700 rounded-xl focus:ring-stone-700 focus:border-b-4 focus:border-stone-700" type="text" id="productInput" onkeyup="filterTable()" required>
                        </div>
                    </td>

                    <td class="bg-amber-50 border-b border-stone-700 text-left pl-7 w-40">
                        <button id="submitButton" class="h-10 px-4 border rounded-xl border-stone-700  hover:border-2 hover:border-b-4 shadow-md">создать</button>
                    </td>
                </tr>
            </form>
            {% for product in product_list %}
            <tr class="">
                <td class="bg-amber-50 hover:bg-amber-100 border-b border-r border-stone-700 text-left px-8 py-4" onclick="setInput('categoryInput', this)">{{product.brand.category.name}}</td>
                <td class="bg-amber-50 hover:bg-amber-100 border-b border-r border-stone-700 text-left px-8 py-4" onclick="setInput('brandInput', this)">{{product.brand.name}}</td>
                <td class="bg-amber-50 hover:bg-amber-100 border-b border-r border-stone-700 text-left px-8 py-4" onclick="setInput('productInput', this)">{{product.name}}</td>
                <td class="bg-amber-50 hover:bg-amber-100 border-b border-stone-700 px-8 py-4 text-center">{{product.amount}}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<script>
    function filterTable() {
        var categoryInput = document.getElementById('categoryInput').value.toLowerCase();
        var brandInput = document.getElementById('brandInput').value.toLowerCase();
        var productInput = document.getElementById('productInput').value.toLowerCase();
        var table = document.getElementById('tableBody');
        var rows = table.getElementsByTagName('tr');

        for (var i = 1; i < rows.length; i++) {
            var categoryCell = rows[i].getElementsByTagName('td')[0];
            var brandCell = rows[i].getElementsByTagName('td')[1];
            var productCell = rows[i].getElementsByTagName('td')[2];

            if (categoryCell && brandCell && productCell) {
                var categoryText = categoryCell.textContent || categoryCell.innerText;
                var brandText = brandCell.textContent || brandCell.innerText;
                var productText = productCell.textContent || productCell.innerText;

                if (categoryText.toLowerCase().indexOf(categoryInput) > -1 &&
                    brandText.toLowerCase().indexOf(brandInput) > -1 &&
                    productText.toLowerCase().indexOf(productInput) > -1) {
                    rows[i].style.display = '';
                } else {
                    rows[i].style.display = 'none';
                }
            }
        }
    }

    function setInput(inputId, cell) {
            document.getElementById(inputId).value = cell.innerText;
            filterTable();
    }

    function clearInput(inputId) {
        document.getElementById(inputId).value = '';
        filterTable();
    }

</script>

{% endblock %}